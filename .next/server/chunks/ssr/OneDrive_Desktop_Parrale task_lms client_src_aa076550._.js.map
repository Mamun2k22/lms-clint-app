{"version":3,"sources":["turbopack:///[project]/OneDrive/Desktop/Parrale task/lms client/src/lib/apis/http.ts","turbopack:///[project]/OneDrive/Desktop/Parrale task/lms client/src/app/learn/[courseId]/page.tsx"],"sourcesContent":["const BASE = process.env.NEXT_PUBLIC_API_BASE!;\r\n\r\n/** Client-side calls (adds Bearer from localStorage) */\r\nexport async function api<T = unknown>(path: string, init: RequestInit = {}): Promise<T> {\r\n  const token = typeof window !== \"undefined\" ? localStorage.getItem(\"token\") : null;\r\n  const headers = new Headers(init.headers);\r\n  if (!headers.has(\"Content-Type\")) headers.set(\"Content-Type\", \"application/json\");\r\n  if (token) headers.set(\"Authorization\", `Bearer ${token}`);\r\n  const res = await fetch(`${BASE}${path}`, { ...init, headers, cache: \"no-store\" });\r\n  if (!res.ok) throw await res.json().catch(() => ({ message: res.statusText }));\r\n  return (await res.json()) as T;\r\n}\r\n\r\n/** Server-side fetch (no token) for public endpoints */\r\nexport async function serverApi<T = unknown>(path: string, init: RequestInit = {}): Promise<T> {\r\n  const res = await fetch(`${BASE}${path}`, { ...init, cache: \"no-store\" });\r\n  if (!res.ok) throw await res.json().catch(() => ({ message: res.statusText }));\r\n  return (await res.json()) as T;\r\n}\r\n","\"use client\";\r\n\r\nimport { useEffect, useMemo, useState } from \"react\";\r\nimport { useParams } from \"next/navigation\";\r\nimport { api, serverApi } from \"@/lib/apis/http\";\r\nimport type { Module, Lecture } from \"@/lib/types\";\r\n\r\n/**\r\n * UI goals covered:\r\n * - Left sidebar: modules -> lectures (expandable feel with headings)\r\n * - Search lectures by title\r\n * - Lock logic: user can only open first lecture or the next after completing previous\r\n * - Checkmarks for completed lectures, progress bar on top\r\n * - Next / Previous navigation\r\n * - Video embed (YouTube) + multiple PDF notes with download links\r\n */\r\n\r\nexport default function LearnPage() {\r\n  const { courseId } = useParams<{ courseId: string }>();\r\n\r\n  // data\r\n  const [modules, setModules] = useState<Module[]>([]);\r\n  const [lectures, setLectures] = useState<Lecture[]>([]);\r\n  const [completed, setCompleted] = useState<string[]>([]); // ids\r\n  const [current, setCurrent] = useState<Lecture | null>(null);\r\n\r\n  // ui\r\n  const [loading, setLoading] = useState(true);\r\n  const [search, setSearch] = useState(\"\");\r\n\r\n  // load everything\r\n  useEffect(() => {\r\n    (async () => {\r\n      setLoading(true);\r\n      const [mods, lecs] = await Promise.all([\r\n        serverApi<Module[]>(`/modules?course=${courseId}`),\r\n        serverApi<Lecture[]>(`/lectures?course=${courseId}`),\r\n      ]);\r\n\r\n      // Sort globally by \"order\" (backend already does, but keep it safe)\r\n      lecs.sort((a, b) => a.order - b.order);\r\n\r\n      setModules(mods);\r\n      setLectures(lecs);\r\n\r\n      // Try to fetch completed (ignore error if API not implemented)\r\n      try {\r\n        const prog = await serverApi<{ completedLectureIds: string[] }>(\r\n          `/progress?course=${courseId}`\r\n        );\r\n        setCompleted(prog.completedLectureIds ?? []);\r\n      } catch {\r\n        setCompleted([]);\r\n      }\r\n\r\n      setCurrent(lecs[0] ?? null);\r\n      setLoading(false);\r\n    })();\r\n  }, [courseId]);\r\n\r\n  // Helpers\r\n  const total = lectures.length;\r\n  const done = completed.length;\r\n  const pct = total ? Math.round((done / total) * 100) : 0;\r\n\r\n  // map moduleId -> lectures\r\n  const grouped = useMemo(() => {\r\n    const m = new Map<string, Lecture[]>();\r\n    modules.forEach((mod) => m.set(mod._id, []));\r\n    lectures.forEach((l) => m.get(l.moduleId)?.push(l));\r\n    // keep module-local order by global \"order\"\r\n    for (const [k, arr] of m.entries()) arr.sort((a, b) => a.order - b.order);\r\n    return m;\r\n  }, [modules, lectures]);\r\n\r\n  // is lecture unlocked per sequential rule\r\n  const isUnlocked = (lec: Lecture) => {\r\n    if (lec.order === 1) return true;\r\n    const prev = lectures.find((x) => x.order === lec.order - 1);\r\n    if (!prev) return true;\r\n    return completed.includes(prev._id);\r\n  };\r\n\r\n  // move to next unlocked lecture after completing current\r\nasync function handleNext() {\r\n  if (!current) return;\r\n\r\n  // mark complete\r\n  try {\r\n    const res = await api<{ completedLectureIds: string[] }>(\"/progress/complete\", {\r\n      method: \"POST\",\r\n      body: JSON.stringify({ courseId, lectureId: current._id }),\r\n    });\r\n    setCompleted(res.completedLectureIds ?? []);\r\n  } catch {\r\n    // if progress API missing, still advance optimistically\r\n    setCompleted((prev) =>\r\n      prev.includes(current._id) ? prev : [...prev, current._id]\r\n    );\r\n  }\r\n\r\n  // go next\r\n  const idx = lectures.findIndex((x) => x._id === current._id);\r\n  const next = lectures[idx + 1];\r\n  if (next) setCurrent(next);\r\n}\r\n\r\n  function handlePrev() {\r\n    if (!current) return;\r\n    const idx = lectures.findIndex((x) => x._id === current._id);\r\n    const prev = lectures[idx - 1];\r\n    if (prev) setCurrent(prev);\r\n  }\r\n\r\n  // small util for YouTube embeds\r\n  const toEmbed = (url: string) =>\r\n    url?.includes(\"watch?v=\") ? url.replace(\"watch?v=\", \"embed/\") : url;\r\n\r\n  if (loading) return <div className=\"p-6\">Loadingâ€¦</div>;\r\n  if (!current) return <div className=\"p-6\">No lectures available yet.</div>;\r\n\r\n  return (\r\n    <div className=\"max-w-7xl mx-auto p-4 md:p-6 grid gap-4 md:gap-6 md:grid-cols-[320px_1fr]\">\r\n      {/* Sidebar */}\r\n      <aside className=\"rounded-2xl border h-[82vh] overflow-auto p-3 space-y-4\">\r\n        {/* Progress */}\r\n        <div>\r\n          <div className=\"flex items-center justify-between text-sm\">\r\n            <span className=\"text-gray-600\">Progress</span>\r\n            <span className=\"font-medium\">\r\n              {done}/{total} â€¢ {pct}%\r\n            </span>\r\n          </div>\r\n          <div className=\"mt-2 h-2 w-full rounded bg-gray-200\">\r\n            <div\r\n              className=\"h-2 rounded bg-black transition-all\"\r\n              style={{ width: `${pct}%` }}\r\n            />\r\n          </div>\r\n        </div>\r\n\r\n        {/* Search */}\r\n        <input\r\n          className=\"w-full rounded-xl border px-3 py-2 outline-none focus:ring-2 focus:ring-black/70\"\r\n          placeholder=\"Search lessonâ€¦\"\r\n          value={search}\r\n          onChange={(e) => setSearch(e.target.value)}\r\n        />\r\n\r\n        {/* Module -> lectures */}\r\n        <div className=\"space-y-3\">\r\n          {modules.map((m) => {\r\n            const list =\r\n              (grouped.get(m._id) ?? []).filter((l) =>\r\n                l.title.toLowerCase().includes(search.toLowerCase())\r\n              ) || [];\r\n            return (\r\n              <div key={m._id} className=\"rounded-xl border\">\r\n                <div className=\"px-3 py-2 font-semibold bg-gray-50 rounded-t-xl\">\r\n                  Module {m.moduleNo}: {m.title}\r\n                </div>\r\n                <ul className=\"p-2 space-y-1\">\r\n                  {list.map((l) => {\r\n                    const active = current._id === l._id;\r\n                    const locked = !isUnlocked(l);\r\n                    const done = completed.includes(l._id);\r\n                    return (\r\n                      <li key={l._id}>\r\n                        <button\r\n                          onClick={() => !locked && setCurrent(l)}\r\n                          className={`w-full text-left px-2 py-1.5 rounded flex items-center gap-2 ${\r\n                            active\r\n                              ? \"bg-black text-white\"\r\n                              : locked\r\n                              ? \"text-gray-400 cursor-not-allowed\"\r\n                              : \"hover:bg-gray-100\"\r\n                          }`}\r\n                        >\r\n                          <span className=\"text-lg leading-none\">\r\n                            {done ? \"âœ…\" : locked ? \"ðŸ”’\" : \"â­•\"}\r\n                          </span>\r\n                          <span className=\"flex-1 truncate\">{l.title}</span>\r\n                          <span className=\"text-xs opacity-70\">#{l.order}</span>\r\n                        </button>\r\n                      </li>\r\n                    );\r\n                  })}\r\n                  {!list.length && (\r\n                    <li className=\"px-2 py-1 text-sm text-gray-500\">\r\n                      No matching lessons\r\n                    </li>\r\n                  )}\r\n                </ul>\r\n              </div>\r\n            );\r\n          })}\r\n        </div>\r\n      </aside>\r\n\r\n      {/* Player + details */}\r\n      <section className=\"space-y-4\">\r\n        <div className=\"rounded-2xl overflow-hidden bg-black aspect-video\">\r\n          <iframe\r\n            className=\"w-full h-full\"\r\n            src={toEmbed(current.videoUrl)}\r\n            title={current.title}\r\n            allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\"\r\n            allowFullScreen\r\n          />\r\n        </div>\r\n\r\n        <div className=\"flex items-center justify-between\">\r\n          <div className=\"font-semibold\">{current.title}</div>\r\n          <div className=\"space-x-2\">\r\n            <button onClick={handlePrev} className=\"px-3 py-2 rounded border\">\r\n              Previous\r\n            </button>\r\n            <button\r\n              onClick={handleNext}\r\n              className=\"px-3 py-2 rounded bg-black text-white\"\r\n            >\r\n              Next\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        {/* PDFs */}\r\n        <div className=\"rounded-2xl border p-4\">\r\n          <h3 className=\"font-semibold mb-2\">Notes (PDF)</h3>\r\n          {current.pdfs?.length ? (\r\n            <ul className=\"list-disc ml-5 space-y-1\">\r\n              {current.pdfs.map((p) => (\r\n                <li key={p.url}>\r\n                  <a\r\n                    className=\"underline\"\r\n                    href={p.url}\r\n                    target=\"_blank\"\r\n                    rel=\"noreferrer\"\r\n                  >\r\n                    {p.name}\r\n                  </a>\r\n                </li>\r\n              ))}\r\n            </ul>\r\n          ) : (\r\n            <div className=\"text-gray-500\">No notes for this lecture.</div>\r\n          )}\r\n        </div>\r\n      </section>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}